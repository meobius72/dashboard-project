# 대시보드 업그레이드 체크리스트

이 체크리스트는 대시보드의 현재 문제를 해결하고 새로운 기능을 구현하는 데 필요한 단계를 안내합니다.

## 1. 주요 문제 해결 (날씨 정보 표시 오류)

-   **`app.py` 관련:**
    -   [ ] **린터 오류 해결:** `app.py` 파일의 현재 발생하고 있는 모든 린터 오류(특히 들여쓰기/구문 오류)를 수정합니다. (가장 우선)
    -   [ ] `safe_int_conversion` 및 `safe_float_conversion` 함수 내의 디버그 출력을 유지하고 필요시 강화합니다. (현재 문제 진단에 필수)
    -   [ ] `get_weather_data` 함수 역할 명확화: 기상청 API에서 원본 데이터를 가져오고 데이터베이스에 저장하는 역할만 하도록 합니다. 불필요한 필터링/포맷팅 로직은 제거하고 API 호출 오류 처리만 담당하게 합니다.
    -   [ ] `get_latest_forecasts_from_db` 함수 로직 강화:
        -   [ ] 데이터베이스에서 최신 원본 날씨 데이터를 가져옵니다.
        -   [ ] 가져온 데이터를 포맷팅합니다.
        -   [ ] `SKY_MAP` 및 `PTY_MAP` 적용 로직을 재확인하고, `str(safe_int_conversion(...))` 패턴이 올바르게 적용되는지 검증합니다.
        -   [ ] `SKY_MAP` 매핑 시 원본 값, 변환된 값, 최종 매핑 결과를 상세히 출력하는 디버깅 코드를 추가합니다.
        -   [ ] 현재 시간 이후 10시간 예측 필터링 로직을 자정 변경을 포함하여 견고하게 구현합니다.
        -   [ ] 필터링된 예측 데이터를 시간 순서대로 정확히 정렬합니다.
        -   [ ] `current_kst`와 각 예측 항목의 `fcst_dt` (forecast datetime)를 출력하여 필터링 로직 동작을 상세히 확인합니다.
-   **`templates/index.html` 관련:**
    -   [ ] 날씨 아이콘 표시: `app.py`에서 전달된 한글 날씨 상태에 따라 적절한 Weather Icon CSS 클래스를 동적으로 할당하는 JavaScript 함수를 추가합니다.
    -   [ ] 시간 표시 수정: 각 날씨 카드에 `forecast_time`에서 시간 부분만 추출하여 "XX시" 형태로 올바르게 표시되도록 합니다.

## 2. 기존 기능 유지보수 및 개선

-   **데이터 소스 및 수집**
    -   [x] 단기 예보를 위한 새로운 데이터 API 또는 소스 식별 (예: 기상청 단기예보 API)
    -   [x] 식별된 데이터 소스에 접근하기 위한 API 키 또는 인증 설정
    -   [x] 새로운 데이터 소스에서 데이터를 수집하는 스크립트 또는 서비스 개발 (예: `fetch_json_kma.py` 수정 또는 새 스크립트 작성)
    -   [x] 데이터 수집 빈도 및 스케줄링 정의 (예: 1시간 또는 3시간마다)
    -   [x] 데이터 수집 중 오류 처리 및 로깅 메커니즘 구현
-   **데이터 모델 및 저장소**
    -   [x] 단기 예보 데이터의 구조 이해 및 기존 데이터 모델과의 호환성 평가
    -   [x] 단기 예보 데이터를 저장하기 위한 데이터베이스 스키마 또는 데이터 모델 업데이트
    -   [x] 기존 장기 예보 데이터와 단기 예보 데이터의 공존 또는 마이그레이션 전략 결정
    -   [x] 데이터베이스에 수집된 단기 예보 데이터 저장 로직 구현
-   **대시보드 구성 요소 및 시각화**
    -   [x] 단기 예보 데이터에 맞게 기존 시각화 구성 요소 수정 (예: 차트, 표, 지도)
    -   [ ] 단기 예보의 특징을 반영하는 새로운 시각화 구성 요소 개발 (예: 시간별 예보 그래프)
    -   [x] 대시보드 UI/UX 업데이트 (이미지 기반 디자인 변경 진행 중)
    -   [x] 사용자에게 단기 예보 데이터를 명확하고 유용하게 표시하는 방법 결정
    -   [x] 교육원 홍보 동영상 임베드 URL 업데이트 (`https://www.youtube.com/embed/vsSxqmwnYvA?mute=1&loop=1&autoplay=1&playlist=yCp0I4KuWJo&style="position:absolute;width:100%;height:100%;left:0"`)
    -   [x] 시간별 날씨 영역에 아이콘 표시 및 데이터 부재 시 아이콘 유지 (삭제하지 않음)
    -   [x] 날씨 영역 오른쪽 하단에 '날씨 정보 수집 오류' 메시지 표시
-   **테스트 및 검증**
    -   [ ] 수집된 단기 예보 데이터의 정확성 및 완전성 검증
    -   [ ] 업데이트된 대시보드 구성 요소의 기능 및 성능 테스트
    -   [ ] 다양한 시나리오 (예: 데이터 없음, API 오류)에 대한 오류 처리 테스트
    -   [ ] 사용자 수용 테스트 (UAT) 수행 및 피드백 수집
-   **배포 및 모니터링**
    -   [ ] 업데이트된 대시보드를 프로덕션 환경에 배포하기 위한 계획 수립
    -   [ ] 배포 전 필요한 종속성 및 환경 설정 확인
    -   [ ] 배포 후 단기 예보 데이터 흐름 및 대시보드 성능 모니터링
    -   [ ] 문제 발생 시 롤백 계획 수립
-   **디자인 개선**
    -   [x] 화면디자인 개선 프로젝트 (첨부 이미지처럼 디자인 변경 - 우선순위 1)
-   **기타**
    -   [ ] 관련 문서 (예: `README.md`) 업데이트
    -   [ ] 팀원들과 변경 사항 및 진행 상황 공유

## 3. 크롤링 기능 및 UI 통합

-   **TS 국가자격시험 공지사항:**
    -   [x] `https://lic.kotsa.or.kr/tsportal/board/index.do?manage_idx=10&menu_idx=9&rowCount=10&viewPage=1`에서 최신 공지사항 3개 크롤링 구현
    -   [x] 크롤링한 데이터를 `templates/index.html`의 공지사항 섹션에 표시
-   **항공교육훈련포털 공지사항:**
    -   [x] 항공교육훈련포털의 공지사항 및 알림 페이지 URL 확인 및 각 페이지에서 최신 3개씩의 항목 크롤링 구현
    -   [x] 크롤링한 데이터를 `templates/index.html`의 공지사항 섹션에 탭 형태로 분리하여 표시

## 날씨 예보 기능 개선

### 목표
기상청 초단기 예보를 단기 예보로 전환하고, 시간 표시 및 날씨 데이터 정확성을 확보하여 10시간 이상의 예측을 올바르게 표시합니다.

### 완료된 작업
- [x] `templates/index.html`에서 시간 표시 오류 수정 (20시로 고정되던 문제 해결).
- [x] `app.py`에서 기상청 API 엔드포인트를 단기 예보 API (`getVilageFcst`)로 변경.
- [x] `app.py`의 `get_base_date_time` 함수를 단기 예보 발표 시각 규칙에 맞춰 수정 (3시간 간격).
- [x] `app.py`의 `get_weather_data` 함수에서 `numOfRows`를 1000으로 증가시켜 더 많은 예보 데이터 확보.
- [x] `app.py`의 `get_latest_forecasts_from_db` 함수에서 기온 카테고리(`TMP`)와 강수량 카테고리(`PCP`) 참조를 올바르게 수정.
- [x] `app.py`의 `get_latest_forecasts_from_db` 함수에서 `PTY` (강수형태) 및 `SKY` (하늘상태) 매핑에 대한 디버그 출력 강화.

### 현재 문제 및 다음 단계
- [ ] **날씨 데이터가 정상적으로 표시되지 않음 (온도 0.0°C, 강수 비정상)**
    - **원인 추정**: `app.py`에서 `index.html`로 전달되는 `weather_data`의 최종 구조에 문제가 있거나, `index.html` 템플릿의 JavaScript 부분에서 데이터가 올바르게 처리되지 못하고 있을 가능성.
    - **해결 방안**: `app.py`의 `index` 함수에서 `render_template` 직전 `weather_data` 변수의 최종 내용을 로그로 출력하여 확인 중. 이 로그를 바탕으로 `index.html`의 JavaScript나 Jinja2 템플릿 로직을 면밀히 검토하고 수정해야 합니다. 특히, `getWeatherIcon` 및 `getWeatherStatusText` 함수가 `forecast.weather.precipitation_type_code`와 `forecast.weather.sky_status_code`를 올바르게 사용하는지 확인해야 합니다.
- [ ] **10개 예보가 표시되지 않음 (여전히 5개만 표시)**
    - **원인 추정**: `get_latest_forecasts_from_db` 함수 내의 필터링 로직 (`current_kst` 이후 10시간 예측 필터링)이 예상대로 작동하지 않을 수 있음. `unique_forecast_datetimes`를 통해 중복을 방지하고 있지만, 단기 예보의 데이터 특성(예보 간격 등)이 고려되지 않았을 수 있습니다.
    - **해결 방안**: `get_latest_forecasts_from_db` 함수 내의 필터링 로직을 재검토하고, 10개의 고유한 시간별 예보를 정확히 가져오도록 로직을 조정해야 합니다. 필요한 경우 `time.sleep`을 사용하여 API 호출 간격을 조절하는 것을 고려할 수 있습니다 (과도한 API 호출 방지).

### 커밋 지침
현재까지의 변경 사항을 로컬 저장소에 커밋하고 원격 저장소에 푸시하려면 다음 명령어를 사용하세요:
```bash
git add app.py templates/index.html upgrade_dash.md
git commit -m "feat: 단기 예보 API 전환 및 날씨 데이터 표시 개선 진행 상황 업데이트"
git push origin master
``` 