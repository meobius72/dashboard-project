# 단기 예보로의 대시보드 업그레이드 체크리스트

이 체크리스트는 대시보드를 장기 예보에서 단기 예보 데이터로 전환하는 데 필요한 단계를 안내합니다.

## 데이터 소스 및 수집
- [x] 단기 예보를 위한 새로운 데이터 API 또는 소스 식별 (예: 기상청 단기예보 API)
- [x] 식별된 데이터 소스에 접근하기 위한 API 키 또는 인증 설정
- [x] 새로운 데이터 소스에서 데이터를 수집하는 스크립트 또는 서비스 개발 (예: `fetch_json_kma.py` 수정 또는 새 스크립트 작성)
- [x] 데이터 수집 빈도 및 스케줄링 정의 (예: 1시간 또는 3시간마다)
- [x] 데이터 수집 중 오류 처리 및 로깅 메커니즘 구현

## 데이터 모델 및 저장소
- [x] 단기 예보 데이터의 구조 이해 및 기존 데이터 모델과의 호환성 평가
- [x] 단기 예보 데이터를 저장하기 위한 데이터베이스 스키마 또는 데이터 모델 업데이트
- [x] 기존 장기 예보 데이터와 단기 예보 데이터의 공존 또는 마이그레이션 전략 결정
- [x] 데이터베이스에 수집된 단기 예보 데이터 저장 로직 구현

## 대시보드 구성 요소 및 시각화
- [x] 단기 예보 데이터에 맞게 기존 시각화 구성 요소 수정 (예: 차트, 표, 지도)
- [ ] 단기 예보의 특징을 반영하는 새로운 시각화 구성 요소 개발 (예: 시간별 예보 그래프)
- [x] 대시보드 UI/UX 업데이트 (이미지 기반 디자인 변경 진행 중)
- [x] 사용자에게 단기 예보 데이터를 명확하고 유용하게 표시하는 방법 결정
- [x] 교육원 홍보 동영상 임베드 URL 업데이트 (https://www.youtube.com/embed/vsSxqmwnYvA?mute=1&loop=1&autoplay=1&playlist=yCp0I4KuWJo&style="position:absolute;width:100%;height:100%;left:0")
- [x] 시간별 날씨 영역에 아이콘 표시 및 데이터 부재 시 아이콘 유지 (삭제하지 않음)
- [x] 날씨 영역 오른쪽 하단에 '날씨 정보 수집 오류' 메시지 표시

## 테스트 및 검증
- [ ] 수집된 단기 예보 데이터의 정확성 및 완전성 검증
- [ ] 업데이트된 대시보드 구성 요소의 기능 및 성능 테스트
- [ ] 다양한 시나리오 (예: 데이터 없음, API 오류)에 대한 오류 처리 테스트
- [ ] 사용자 수용 테스트 (UAT) 수행 및 피드백 수집

## 배포 및 모니터링
- [ ] 업데이트된 대시보드를 프로덕션 환경에 배포하기 위한 계획 수립
- [ ] 배포 전 필요한 종속성 및 환경 설정 확인
- [ ] 배포 후 단기 예보 데이터 흐름 및 대시보드 성능 모니터링
- [ ] 문제 발생 시 롤백 계획 수립

## 디자인 개선
- [x] 화면디자인 개선 프로젝트 (첨부 이미지처럼 디자인 변경 - 우선순위 1)
- [ ] 날씨 API 관련 사항 (키 확인 시까지 홀드)

## 기타
- [ ] 관련 문서 (예: README.md) 업데이트
- [ ] 팀원들과 변경 사항 및 진행 상황 공유

# 대시보드 업그레이드 계획

## 날씨 정보 업데이트
- 기상청 단기예보 API(VilageFcstInfoService_2.0) 활용
- 초단기실황 조회(getUltraSrtNcst) 사용
- 경기기계공업고등학교 위치 좌표: nx=55, ny=127
- **API 키 (디코딩): PcVFXfWoNUlki9AS6y8ODPyW2KZKyHfrGdy6rFnMUNIBZxhC2+KnUUekPDtfSBCRBWfR/G+9UpcQwuHBZFR+Xw==**

### 구현 계획
1. app.py 수정
   - 기존 날씨 관련 코드 제거 (완료)
   - 기상청 API 호출 함수 추가 (완료)
   - 초단기실황 데이터 파싱 로직 구현 (완료)
   - **새로운 디코딩된 API 키 반영 (완료)**
   - **base_time 로직 개선 (매시 10분 이후 호출 조건 반영) (완료)**
   - **오래된 KMA API 관련 클래스 및 함수 제거**

2. templates/index.html 수정
   - 날씨 정보 표시 섹션 업데이트 (완료)
   - API 응답 데이터 파싱 및 표시 로직 구현 (완료)
   - 에러 처리 로직 추가 (완료)

### API 응답 데이터 항목
- T1H: 기온(℃)
- RN1: 1시간 강수량(mm)
- UUU: 동서바람성분(m/s)
- VVV: 남북바람성분(m/s)
- REH: 습도(%)
- PTY: 강수형태(코드값)
- VEC: 풍향(deg)
- WSD: 풍속(m/s)

### 에러 코드 처리
- 00: 정상
- 03: 데이터없음 에러 (발생 시 base_time 확인 필요)
- 30: 등록되지 않은 서비스키 (최신 키 반영 및 승인 확인 필요)

## 날씨 정보 기능 업데이트 (getUltraSrtNcst 서비스)

### 2025년 06월 13일 (추가 업데이트)

*   **API 키 활용 승인 및 URL 인코딩 확인:** 사용자께서 제공해주신 스크린샷을 통해 API 키 (`PcVFXfWoNUlki9AS6y8ODPyW2KZKyHfrGdy6rFnMUNIBZxhC2+KnUUekPDtfSBCRBWfR/G+9UpcQwuHBZFR+Xw==`)가 '기상청_단기예보 ((구)_동네예보) 조회서비스'의 '초단기실황조회 (getUltraSrtNcst)' 기능에 대해 **활용 승인이 완료된 유효한 키임**을 확인했습니다.
*   **`app.py` 수정:**
    *   `WEATHER_API_KEY`에 `urllib.parse.quote_plus()`를 사용하여 API 키가 URL 인코딩되도록 적용했습니다. (예: `PcVFXfWoNUlki9AS6y8ODPyW2KZKyHfrGdy6rFnMUNIBZxhC2%2BKnUUekPDtfSBCRBWfR%2FG%2B9UpcQwuHBZFR%2BXw%3D%3D`)
    *   불필요한 `math` 모듈 임포트를 제거했습니다.
*   **잔여 오류 원인 분석 및 해결 방안:**
    *   기존 터미널 출력에서 계속 발생했던 `SERVICE_KEY_IS_NOT_REGISTERED_ERROR`는 API 키 자체의 문제라기보다는 **이전 Flask 프로세스의 잔여** 또는 **브라우저 캐시** 문제로 인해 오래된 설정이 로드되었을 가능성이 높습니다.
    *   `app.py` 및 `templates/index.html`에서 이전 API 호출 로직을 직접 제거했음에도 불구하고 `fct_shrt_reg.php` 또는 `/weather` 라우트 오류가 발생하는 것 역시 **이전 Flask 프로세스 잔여** 또는 **브라우저 캐시** 문제로 판단됩니다.
*   **사용자 지시사항:**
    *   **모든 Flask 프로세스를 강제 종료**하고 재시작하도록 안내했습니다.
    *   **웹 브라우저의 캐시를 지우거나 시크릿 모드로 접속**하여 테스트하도록 안내했습니다. 